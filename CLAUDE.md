# PyPlc Ver3 - PLC標準仕様完全準拠システム

## 📋 **プロジェクト概要**
- **目的**: PLC標準仕様完全準拠ラダー図シミュレーター
- **開始日**: 2025-01-28
- **現在バージョン**: Ver3.0（クリーン実装）
- **アーキテクチャ**: ゼロからクリーン実装（Ver2資産活用）

## 🎯 **Ver3の設計思想**

### **基本概念**
- **PLC標準準拠**: 接点（入力条件）/コイル（出力結果）の正しい実装
- **教育的価値**: 実PLC移行時の違和感なし
- **実用性**: 工場検証用途対応

### **Ver1/Ver2からの進化**
- **Ver1**: プロトタイプ（内部データと表示の不整合問題）
- **Ver2**: モジュール化・安定化（INCOIL/OUTCOIL概念の混乱）
- **Ver3**: PLC標準準拠・教育効果最大化

### **重要な概念変更**
#### ❌ **Ver2廃止概念**
```python
INCOIL = "INCOIL"          # 入力コイル（PLC標準にない概念）
OUTCOIL_NML = "OUTCOIL_NML" # 出力コイル（用語が不適切）
OUTCOIL_REV = "OUTCOIL_REV" # 反転出力コイル（概念混乱）
```

#### ✅ **Ver3正しい概念**
```python
# 接点系（入力条件表現）
CONTACT_A = "CONTACT_A"    # A接点 -| |-
CONTACT_B = "CONTACT_B"    # B接点 -|/|-

# コイル系（出力結果表現）
COIL = "COIL"              # 通常コイル -( )-
COIL_REV = "COIL_REV"      # 反転コイル -(/)-
```

## 📋 **開発プラン**

### **Phase 1: 基本グリッドシステム（現在実行中）**
- [x] Hello World表示システム
- [x] config.py（Ver3設定定数）
- [x] 30FPS最適化
- [x] Pyxel色定数直接使用
- [ ] グリッド描画システム（15行×20列）
- [ ] マウス入力システム
- [ ] 基本デバイスクラス（PLC標準準拠）

### **Phase 2: デバイス配置システム（予定）**
- [ ] デバイスパレット（1-0キー）
- [ ] デバイス配置・削除機能
- [ ] デバイス状態管理
- [ ] 基本接点・コイル実装

### **Phase 3: 電気的継続性システム（予定）**
- [ ] LINK_SIDE（水平配線）実装
- [ ] 明示的配線トレース
- [ ] 電力フロー計算
- [ ] 自己保持回路対応

### **Phase 4: 高度機能（予定）**
- [ ] タイマー・カウンター実装
- [ ] 複雑回路対応
- [ ] デバッグ・検証機能

## 📊 **開発進捗**

### **2025-01-28 (開発開始)**
#### ✅ **完了作業**
- Ver3クリーン実装開始
- Hello World表示システム完成
- config.py作成（Ver3専用設定）
- DisplayConfig: 384x384, 30FPS
- GridConfig: 15行×20列
- PLCConfig, DeviceType（PLC標準準拠）
- Pyxel色定数直接使用（バグ防止）

#### 🚧 **現在作業中**
- Phase 1: 基本グリッドシステム

#### 📝 **次回作業予定**
- グリッド描画システム実装
- マウス入力システム実装
- PLC標準デバイス基底クラス

## ⚠️ **重要な注意事項**

### **AI開発支援情報**
```python
# For AI Support - このコメントは消さないでください

## 実行環境は .vscode/ 以下のファイルに定義してあります

# 返答は日本語でお願いします
# pythonとはいえ、型はちゃんと宣言してください
# コメントも日本語でつけて下さい
# ステップバイステップで作業をしながら git にチェックインしながらすすめるので、ユーザーに都度確認してください。
# ですので、ドンドンとコードを書いて進めないで下さい

# 配列関係の処理をする時は  grid[row][col]  # [y座標][x座標] の順序 って書いておいてくれると、僕がわかりやすいです　
```

### **座標系の完全統一（Ver1の教訓）**
```python
# ❌ Ver1の問題: 内部データと表示データの齟齬
internal_data[row][col]  # 内部: [y座標][x座標]
display_pos(x, y)        # 表示: (x座標, y座標)

# ✅ Ver3の解決: 完全統一された座標系
grid[row][col]  # 常に [y座標][x座標] で統一
position: tuple[int, int]  # (row, col) = (y座標, x座標)
```

### **色定数の正しい使用**
```python
# ❌ 間違った方法: 再定義によるバグ
BLACK = pyxel.COLOR_BLACK  # バグの温床

# ✅ 正しい方法: 直接使用
pyxel.cls(pyxel.COLOR_BLACK)
pyxel.text(x, y, "text", pyxel.COLOR_WHITE)
```

### **PLC概念の正しい理解**
```python
# ✅ 正しいPLC概念
"""
接点（Contact）:
- 他のデバイスの状態を「読み取る」素子
- 入力条件を表現
- -| |- (A接点), -|/|- (B接点)

コイル（Coil）:  
- デバイスの状態を「設定する」素子
- 出力結果を表現
- -( )- (通常), -(/)-（反転）
"""
```

## 🔧 **実行環境**

### **実行方法**
```bash
# 仮想環境での実行（必須）
./venv/bin/python main.py

# VSCode デバッグ実行
# "Python デバッガー: 現在のファイル" を使用
```

### **開発環境設定**
- **Python**: 3.8+
- **仮想環境**: `./venv/bin/python`
- **VSCode設定**: `.vscode/launch.json`, `.vscode/settings.json`
- **ライブラリ**: Pyxel 1.9.0+

### **プロジェクト構造**
```
PyPlc/
├── main.py                 # Ver3メインアプリケーション
├── config.py               # Ver3専用設定定数
├── Ver3_Definition.md      # Ver3完全定義書
├── CLAUDE.md              # 開発記録（このファイル）
├── New_Docs/              # 要件・仕様書類
├── Project Ver01/         # Ver1バックアップ
├── Project Ver02/         # Ver2バックアップ
└── venv/                  # Python仮想環境
```

## 📚 **参考ドキュメント**

### **必読ドキュメント**
- `Ver3_Definition.md`: Ver3の完全定義・AI開発支援情報
- `New_Docs/Requirements_v3.txt`: 要件定義書
- `New_Docs/Question.txt`: 仕様確認・回答記録

### **Ver2資産活用情報**
- `Project Ver02/`: Ver2の成功パターン参考
- Ver2の優良資産: モジュール化、グリッド座標系、60FPS安定動作
- Ver2の問題要素: INCOIL/OUTCOIL概念、用語不統一

## 🎯 **成功基準**

### **Phase 1完了基準**
- [ ] 15行×20列グリッド正確表示
- [ ] マウス座標→グリッド座標変換
- [ ] PLC標準デバイス基底クラス
- [ ] 座標系完全統一確認

### **Ver3最終成功基準**
- [ ] PLC教科書レベル回路100%動作
- [ ] 自己保持回路完全動作
- [ ] 実PLC仕様完全準拠
- [ ] 30FPS安定動作維持

---

**このCLAUDE.mdは、Ver3開発の完全な記録として継続更新されます。**

*最終更新: 2025-01-28*  
*次回更新: Phase 1完了時*