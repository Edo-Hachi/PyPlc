# PyPlc Ver3 UIシステム開発プラン

## 📋 **プロジェクト概要**
- **対象**: PyPlc Ver3 PLC標準仕様準拠ラダー図シミュレーター
- **目標**: Ver2の成功パターンを活用したUI機能強化
- **設計方針**: シンプル・可読性重視、30FPS安定動作維持

## 🔍 **Ver2 UIシステム調査結果**

### **Ver2の成功パターン（★5評価）**
1. **マウス座標変換システム**: O(1)最適化、平方根計算回避
2. **デバイスパレットシステム**: 10×2段、マウス・キーボード両対応
3. **座標変換最適化**: 数学的直接計算による高速化

### **Ver3で改善すべき点**
- 過度なモジュール分割の回避（Ver2: 8モジュール → Ver3: 4-5モジュール）
- 設定管理の一元化（config.py集約）
- PLC標準準拠の徹底（CONTACT/COIL体系）

## 🎯 **実装戦略と優先度**

### **🔥 Phase 1: 高速化・最適化（最優先）**

#### **1. Ver2マウス座標変換システム移植**
**優先度**: ★★★★★  
**工数**: 2-3時間  
**効果**: パフォーマンス大幅向上、30FPS安定化

```python
# 実装内容
- O(1)最近隣計算アルゴリズム移植
- 平方根計算回避による高速化
- スナップしきい値の精密制御
- core/input_handler.py の screen_to_grid() メソッド改良
```

**実装ファイル**: `core/input_handler.py`  
**移植元**: `Project Ver02/core/input_handler.py`

#### **2. Ver2ステータス表示システム移植**
**優先度**: ★★★★★  
**工数**: 2-3時間  
**効果**: デバッグ効率向上、ユーザビリティ向上

```python
# 実装内容
- マウス位置詳細情報表示
- スナップモード状態表示
- 編集可能領域判定表示
- デバイス選択状態詳細表示
```

**実装ファイル**: `main.py` の `_draw_cursor_and_status()` 改良  
**移植元**: `Project Ver02/core/renderer.py`

### **⚡ Phase 2: 操作性向上（高優先度）**

#### **3. グリッドスナップ機能高度化**
**優先度**: ★★★★☆  
**工数**: 3-4時間  
**効果**: 操作精度向上

```python
# 実装内容
- しきい値による段階的スナップ制御
- 視覚的フィードバック強化
- エッジケース処理改善
- スナップモード切り替え機能
```

**実装ファイル**: `core/input_handler.py` 拡張

#### **4. マウスカーソル視覚的改善**
**優先度**: ★★★☆☆  
**工数**: 2-3時間  
**効果**: 直感的操作性向上

```python
# 実装内容
- 状況に応じたカーソル色変更
- スナップ状態の明確な視覚化
- 編集可能領域の視覚的区別
- ホバーエフェクトの精密化
```

**実装ファイル**: `main.py` の描画メソッド群

### **✨ Phase 3: 機能拡張（中優先度）**

#### **5. 基本ダイアログシステム設計**
**優先度**: ★★☆☆☆  
**工数**: 4-6時間  
**効果**: 将来の機能拡張基盤

```python
# 実装内容
- シンプルなダイアログ基底クラス
- モーダル表示機能
- 基本的な入力検証機能
```

**実装ファイル**: 新規 `core/dialog_system.py`

#### **6. デバイスアドレス入力ダイアログ実装**
**優先度**: ★★☆☆☆  
**工数**: 4-6時間  
**効果**: デバイス設定機能追加

```python
# 実装内容
- デバイスアドレス入力フィールド
- PLC標準準拠のアドレス検証
- OK/Cancelボタン
- 既存システムとの統合
```

**実装ファイル**: `core/dialog_system.py` 拡張

## 📊 **実装スケジュール**

### **Week 1: Phase 1完了目標**
- [x] Ver2 UIシステム調査・分析
- [ ] Ver2マウス座標変換システム移植
- [ ] Ver2ステータス表示システム移植

### **Week 2: Phase 2完了目標**
- [ ] グリッドスナップ機能高度化
- [ ] マウスカーソル視覚的改善
- [ ] 統合テスト・デバッグ

### **Week 3: Phase 3基盤整備**
- [ ] 基本ダイアログシステム設計
- [ ] デバイスアドレス入力ダイアログ実装

## 🎯 **成功基準**

### **Phase 1完了基準**
- [ ] マウス操作のレスポンス時間50%向上
- [ ] 30FPS安定動作確保
- [ ] ステータス情報の詳細表示実現

### **Phase 2完了基準**
- [ ] スナップ操作の精度向上
- [ ] 視覚的フィードバックの直感性向上
- [ ] ユーザビリティテスト合格

### **Phase 3完了基準**
- [ ] 基本ダイアログ機能の動作確認
- [ ] デバイスアドレス設定機能の実現

## 🏗️ **技術仕様**

### **アーキテクチャ設計方針**
- **シンプル性維持**: Ver2の複雑性を回避
- **モジュール統合**: 必要最小限のファイル構成
- **PLC標準準拠**: CONTACT/COIL体系の徹底
- **性能優先**: 30FPS安定動作の維持

### **ファイル構成計画**
```
PyPlc/
├── main.py                    # UI統合制御（拡張）
├── config.py                  # 設定一元管理（拡張）
├── core/
│   ├── input_handler.py       # 入力処理（Ver2機能移植）
│   ├── device_palette.py      # デバイスパレット（完成済み）
│   ├── grid_system.py         # グリッドシステム（既存）
│   ├── circuit_analyzer.py    # 回路解析（既存）
│   └── dialog_system.py       # ダイアログシステム（新規）
└── CLAUDE.md                  # 開発記録
```

### **Ver2からの移植対象メソッド**
```python
# 高優先度移植対象
Project Ver02/core/input_handler.py:
  - screen_to_grid()           # 座標変換最適化
  - _calculate_snap_position() # スナップ計算

Project Ver02/core/renderer.py:
  - draw_status_bar()          # ステータス表示
  - draw_cursor_info()         # カーソル情報
```

## 📝 **開発ガイドライン**

### **実装時の注意点**
1. **既存機能の破壊禁止**: 現在動作している機能を壊さない
2. **段階的実装**: 一度に複数機能を実装しない
3. **テスト駆動**: 各Phase完了時に動作確認
4. **可読性優先**: コメント充実、メソッド分割

### **品質基準**
- **パフォーマンス**: 30FPS維持必須
- **可読性**: 新規開発者が理解可能
- **保守性**: 機能追加・修正が容易
- **安定性**: クラッシュ・フリーズなし

## 🔄 **継続的改善**

### **フィードバックループ**
1. **実装** → **テスト** → **評価** → **改善**
2. **Phase完了毎の振り返り**
3. **ユーザビリティ観点での評価**

### **将来拡張の考慮**
- **Web化対応**: 将来のWebベース移行
- **マルチユーザー**: 複数ユーザー同時編集
- **API化**: 外部システム連携

---

**作成日**: 2025-08-02  
**最終更新**: 2025-08-02  
**ステータス**: Phase 1実装準備完了  
**次回更新**: Phase 1完了時