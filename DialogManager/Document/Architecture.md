# DialogManager ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆæ›¸

**ç–çµåˆãƒ»æ‹¡å¼µå¯èƒ½ãƒ»JSONé§†å‹• - æ¬¡ä¸–ä»£ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ ã®è¨­è¨ˆæ€æƒ³**

---

## ğŸ¯ è¨­è¨ˆæ€æƒ³ãƒ»åŸºæœ¬åŸå‰‡

### 1. **ç–çµåˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ (Loose Coupling)**
ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“ã®ä¾å­˜é–¢ä¿‚ã‚’æœ€å°é™ã«æŠ‘ãˆã€å¤‰æ›´ã®å½±éŸ¿ç¯„å›²ã‚’å±€æ‰€åŒ–

```python
# âŒ å¯†çµåˆãªè¨­è¨ˆä¾‹
class BadDialog:
    def __init__(self):
        self.text_input = TextInputControl()  # ç›´æ¥ä¾å­˜
        self.text_input.on_change = self.handle_change  # å¼·çµåˆ

# âœ… ç–çµåˆãªè¨­è¨ˆä¾‹  
class GoodDialog(BaseDialog):
    def __init__(self):
        super().__init__()
        self.event_system.register("text_changed", self.handle_change)  # ã‚¤ãƒ™ãƒ³ãƒˆçµŒç”±
```

### 2. **JSONé§†å‹•UI (Declarative UI)**
ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãƒ­ã‚¸ãƒƒã‚¯ã¨UIå®šç¾©ã‚’åˆ†é›¢ã—ã€å®£è¨€çš„ãªè¨˜è¿°ã«ã‚ˆã‚‹ä¿å®ˆæ€§å‘ä¸Š

```json
{
  "title": "è¨­å®šãƒ€ã‚¤ã‚¢ãƒ­ã‚°",
  "controls": [
    {
      "type": "textinput",
      "id": "device_id",
      "validation": "plc_device_address"
    }
  ]
}
```

### 3. **æ‹¡å¼µæ€§å„ªå…ˆ (Extensibility First)**
æ–°æ©Ÿèƒ½è¿½åŠ ãƒ»æ—¢å­˜æ©Ÿèƒ½å¤‰æ›´ãŒå®¹æ˜“ãªè¨­è¨ˆ

```python
# æ–°ã—ã„ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚¿ã‚¤ãƒ—ã®è¿½åŠ 
class CustomControl(BaseControl):
    pass

# ControlFactoryã¸ã®ç™»éŒ²ã®ã¿ã§ä½¿ç”¨å¯èƒ½
factory.register_control("custom", CustomControl)
```

### 4. **PLCæ¨™æº–æº–æ‹  (Industry Standard Compliance)**
å®Ÿéš›ã®PLCæ¥­ç•Œæ¨™æº–ã«æº–æ‹ ã—ãŸæ­£ç¢ºãªå®Ÿè£…

---

## ğŸ—ï¸ ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### å…¨ä½“æ§‹æˆå›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PyPlc Ver3 Main Application              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  DialogManager                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚              JSON Definition Layer                      â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚â”‚
â”‚  â”‚  â”‚test_confirm â”‚ â”‚device_settingsâ”‚ â”‚file_load_dialog â”‚   â”‚â”‚
â”‚  â”‚  â”‚   .json     â”‚ â”‚    .json      â”‚ â”‚     .json       â”‚   â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                        â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚               Core Framework Layer                      â”‚â”‚
â”‚  â”‚                                                         â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚
â”‚  â”‚  â”‚JSONDialog   â”‚    â”‚ControlFactoryâ”‚    â”‚EventSystem  â”‚ â”‚â”‚
â”‚  â”‚  â”‚Loader       â”‚â—„â”€â”€â–ºâ”‚             â”‚â—„â”€â”€â–ºâ”‚             â”‚ â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚
â”‚  â”‚           â”‚                 â”‚                 â”‚        â”‚â”‚
â”‚  â”‚           â–¼                 â–¼                 â–¼        â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚
â”‚  â”‚  â”‚                BaseDialog                           â”‚â”‚â”‚
â”‚  â”‚  â”‚  â€¢ ãƒ¢ãƒ¼ãƒ€ãƒ«å‡¦ç†  â€¢ åº§æ¨™å¤‰æ›  â€¢ ã‚¤ãƒ™ãƒ³ãƒˆçµ±åˆ        â”‚â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                        â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚              Control Implementation Layer               â”‚â”‚
â”‚  â”‚                                                         â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚â”‚
â”‚  â”‚  â”‚TextInput    â”‚ â”‚FileList     â”‚ â”‚Button/Label     â”‚   â”‚â”‚
â”‚  â”‚  â”‚Control      â”‚ â”‚Control      â”‚ â”‚Control          â”‚   â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                        â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚               Support Systems Layer                     â”‚â”‚
â”‚  â”‚                                                         â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚â”‚
â”‚  â”‚  â”‚Validation   â”‚              â”‚Integration Tests    â”‚   â”‚â”‚
â”‚  â”‚  â”‚System       â”‚              â”‚& Quality Assurance  â”‚   â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ãƒ»å‡¦ç†ãƒ•ãƒ­ãƒ¼

### 1. **ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ç”Ÿæˆãƒ•ãƒ­ãƒ¼**

```
JSONå®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚JSONDialogLoader â”‚ â”€â”€â”€â”€ JSONè§£æãƒ»æ¤œè¨¼
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ControlFactory   â”‚ â”€â”€â”€â”€ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«å‹•çš„ç”Ÿæˆ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚BaseDialog       â”‚ â”€â”€â”€â”€ ãƒ€ã‚¤ã‚¢ãƒ­ã‚°çµ±åˆãƒ»åº§æ¨™å¤‰æ›
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚EventSystem      â”‚ â”€â”€â”€â”€ ã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²ãƒ»åˆæœŸåŒ–
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
   è¡¨ç¤ºãƒ»å®Ÿè¡Œ
```

### 2. **ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ãƒ•ãƒ­ãƒ¼**

```
ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œ (ãƒã‚¦ã‚¹ãƒ»ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰)
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚BaseDialog       â”‚ â”€â”€â”€â”€ å…¥åŠ›ã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚åº§æ¨™å¤‰æ›ã‚·ã‚¹ãƒ†ãƒ   â”‚ â”€â”€â”€â”€ çµ¶å¯¾åº§æ¨™â†’ç›¸å¯¾åº§æ¨™å¤‰æ›
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚å¯¾è±¡Control      â”‚ â”€â”€â”€â”€ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«å›ºæœ‰å‡¦ç†
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚EventSystem      â”‚ â”€â”€â”€â”€ ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ãƒ»é€šçŸ¥
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ â”‚ â”€â”€â”€â”€ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§© ã‚³ã‚¢ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè©³ç´°

### 1. **BaseDialog - ãƒ€ã‚¤ã‚¢ãƒ­ã‚°åŸºåº•ã‚¯ãƒ©ã‚¹**

#### è²¬å‹™
- ãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã®åŸºæœ¬å‹•ä½œåˆ¶å¾¡
- åº§æ¨™å¤‰æ›ã‚·ã‚¹ãƒ†ãƒ ï¼ˆçµ¶å¯¾åº§æ¨™â‡”ç›¸å¯¾åº§æ¨™ï¼‰
- ã‚¤ãƒ™ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ã¨ã®çµ±åˆ
- æç”»ãƒ»å…¥åŠ›å‡¦ç†ã®çµ±ä¸€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹

#### è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³
- **Template Method Pattern**: å…±é€šå‡¦ç†ã®çµ±ä¸€
- **Facade Pattern**: è¤‡é›‘ãªã‚µãƒ–ã‚·ã‚¹ãƒ†ãƒ ã®éš è”½

```python
class BaseDialog(ABC):
    def __init__(self, title: str = "", width: int = 200, height: int = 150):
        # åº§æ¨™å¤‰æ›ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
        self.x = (pyxel.width - width) // 2
        self.y = (pyxel.height - height) // 2
        
        # ã‚¤ãƒ™ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ çµ±åˆ
        self.event_system = EventSystem()
        
    def to_local_coords(self, abs_x: int, abs_y: int) -> Tuple[int, int]:
        """çµ¶å¯¾åº§æ¨™â†’ç›¸å¯¾åº§æ¨™å¤‰æ›"""
        return (abs_x - self.x, abs_y - self.y)
        
    def to_absolute_coords(self, local_x: int, local_y: int) -> Tuple[int, int]:
        """ç›¸å¯¾åº§æ¨™â†’çµ¶å¯¾åº§æ¨™å¤‰æ›"""
        return (local_x + self.x, local_y + self.y)
```

### 2. **JSONDialogLoader - JSONå®šç¾©èª­ã¿è¾¼ã¿**

#### è²¬å‹™
- JSONå®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ãƒ»è§£æ
- å®šç¾©å†…å®¹ã®å¦¥å½“æ€§æ¤œè¨¼
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ã«ã‚ˆã‚‹æ€§èƒ½æœ€é©åŒ–

#### è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³
- **Singleton Pattern**: ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªãƒ­ãƒ¼ãƒ€ãƒ¼ç®¡ç†
- **Factory Method Pattern**: å®šç¾©ã‹ã‚‰ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆ

```python
class JSONDialogLoader:
    def __init__(self):
        self._cache: Dict[str, Dict] = {}
        
    def load_dialog(self, definition_path: str) -> Dict[str, Any]:
        """JSONå®šç¾©èª­ã¿è¾¼ã¿ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥å¯¾å¿œï¼‰"""
        if definition_path in self._cache:
            return self._cache[definition_path]
            
        # ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ãƒ»è§£æãƒ»æ¤œè¨¼
        dialog_data = self._load_and_validate(definition_path)
        self._cache[definition_path] = dialog_data
        return dialog_data
```

### 3. **ControlFactory - å‹•çš„ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ç”Ÿæˆ**

#### è²¬å‹™
- JSONå®šç¾©ã‹ã‚‰ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆ
- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚¿ã‚¤ãƒ—ã®ç™»éŒ²ãƒ»ç®¡ç†
- æ‹¡å¼µå¯èƒ½ãªãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼ã‚·ã‚¹ãƒ†ãƒ 

#### è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³
- **Abstract Factory Pattern**: ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ç”Ÿæˆã®æŠ½è±¡åŒ–
- **Registry Pattern**: å‹•çš„ãªã‚¿ã‚¤ãƒ—ç™»éŒ²

```python
class ControlFactory:
    def __init__(self):
        self.control_creators: Dict[str, Callable] = {}
        self._register_basic_controls()
        
    def register_control(self, control_type: str, creator_func: Callable):
        """æ–°ã—ã„ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚¿ã‚¤ãƒ—ã®ç™»éŒ²"""
        self.control_creators[control_type] = creator_func
        
    def create_control(self, control_definition: Dict[str, Any]) -> Optional[BaseControl]:
        """JSONå®šç¾©ã‹ã‚‰ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ç”Ÿæˆ"""
        control_type = control_definition.get("type", "label")
        if control_type not in self.control_creators:
            return None
            
        creator_func = self.control_creators[control_type]
        return creator_func(control_definition)
```

### 4. **EventSystem - ç–çµåˆã‚¤ãƒ™ãƒ³ãƒˆé€šçŸ¥**

#### è²¬å‹™
- ã‚¤ãƒ™ãƒ³ãƒˆã®ç™»éŒ²ãƒ»ç™ºç«ãƒ»é€šçŸ¥
- ã‚¤ãƒ™ãƒ³ãƒˆå„ªå…ˆåº¦ç®¡ç†
- ä¼æ’­åˆ¶å¾¡ï¼ˆstopPropagationç­‰ï¼‰

#### è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³
- **Observer Pattern**: ã‚¤ãƒ™ãƒ³ãƒˆé€šçŸ¥ã®ç–çµåˆåŒ–
- **Command Pattern**: ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ã®æŠ½è±¡åŒ–

```python
class DialogEventSystem(EventEmitter):
    def __init__(self):
        super().__init__()
        self._event_priorities: Dict[str, int] = {}
        self._propagation_stopped: Dict[str, bool] = {}
        
    def emit(self, event_name: str, *args, **kwargs):
        """ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ãƒ»å„ªå…ˆåº¦é †é€šçŸ¥"""
        if self._propagation_stopped.get(event_name, False):
            return
            
        # å„ªå…ˆåº¦é †ã§ãƒãƒ³ãƒ‰ãƒ©ãƒ¼å®Ÿè¡Œ
        for handler in self._get_sorted_handlers(event_name):
            handler(*args, **kwargs)
```

---

## ğŸ”Œ æ‹¡å¼µæ€§ã®ä»•çµ„ã¿

### 1. **æ–°ã—ã„ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚¿ã‚¤ãƒ—ã®è¿½åŠ **

```python
# Step 1: BaseControlã‚’ç¶™æ‰¿
class CustomControl(BaseControl):
    def __init__(self, **kwargs):
        super().__init__(**kwargs)
        # ã‚«ã‚¹ã‚¿ãƒ åˆæœŸåŒ–
        
    def handle_input(self, mouse_x: int, mouse_y: int) -> bool:
        # ã‚«ã‚¹ã‚¿ãƒ å…¥åŠ›å‡¦ç†
        pass
        
    def draw(self, offset_x: int = 0, offset_y: int = 0):
        # ã‚«ã‚¹ã‚¿ãƒ æç”»å‡¦ç†
        pass

# Step 2: ControlFactoryã«ç™»éŒ²
def create_custom_control(definition: Dict[str, Any]) -> CustomControl:
    return CustomControl(**definition)

factory.register_control("custom", create_custom_control)

# Step 3: JSONå®šç¾©ã§ä½¿ç”¨
{
  "type": "custom",
  "id": "my_custom_control",
  "custom_property": "value"
}
```

### 2. **æ–°ã—ã„ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—ã®è¿½åŠ **

```python
# Step 1: ã‚¤ãƒ™ãƒ³ãƒˆå®šç¾©
class CustomEvent:
    def __init__(self, data):
        self.data = data

# Step 2: ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«
self.event_system.emit("custom_event", CustomEvent(data))

# Step 3: ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ç™»éŒ²
def handle_custom_event(event):
    print(f"Custom event received: {event.data}")

self.event_system.register("custom_event", handle_custom_event)
```

### 3. **æ–°ã—ã„ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ«ã®è¿½åŠ **

```python
# Step 1: ãƒãƒªãƒ‡ãƒ¼ã‚¿ãƒ¼å®Ÿè£…
class CustomValidator(BaseValidator):
    def validate(self, value: str) -> ValidationResult:
        # ã‚«ã‚¹ã‚¿ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†
        if self._is_valid(value):
            return ValidationResult(True, "")
        else:
            return ValidationResult(False, "Invalid format")

# Step 2: ãƒãƒªãƒ‡ãƒ¼ã‚¿ãƒ¼ã‚·ã‚¹ãƒ†ãƒ ã«ç™»éŒ²
validator_system.register("custom_rule", CustomValidator())

# Step 3: JSONå®šç¾©ã§ä½¿ç”¨
{
  "type": "textinput",
  "validation": "custom_rule"
}
```

---

## ğŸ¯ è¨­è¨ˆä¸Šã®é‡è¦ãªæ±ºå®šäº‹é …

### 1. **åº§æ¨™å¤‰æ›ã‚·ã‚¹ãƒ†ãƒ ã®çµ±ä¸€**

**å•é¡Œ**: Phase 2é–‹ç™ºæ™‚ã«ã€çµ¶å¯¾åº§æ¨™ã¨ç›¸å¯¾åº§æ¨™ã®æ··åœ¨ã«ã‚ˆã‚Šã‚¯ãƒªãƒƒã‚¯åˆ¤å®šãŒå¤±æ•—

**è§£æ±º**: BaseDialogã§ã®çµ±ä¸€çš„ãªåº§æ¨™å¤‰æ›ã‚·ã‚¹ãƒ†ãƒ å®Ÿè£…

```python
# å…¨ã¦ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã§çµ±ä¸€ã•ã‚ŒãŸåº§æ¨™å¤‰æ›
def handle_mouse_click(self, abs_x: int, abs_y: int) -> bool:
    local_x, local_y = self.parent_dialog.to_local_coords(abs_x, abs_y)
    return self._is_point_inside(local_x, local_y)
```

### 2. **EventSystemã®å‘½åçµ±ä¸€**

**å•é¡Œ**: `DialogEventSystem`ã¨`EventSystem`ã®å‘½åæ··åœ¨

**è§£æ±º**: ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã«ã‚ˆã‚‹å¾Œæ–¹äº’æ›æ€§ç¢ºä¿

```python
# events/event_system.py
class DialogEventSystem(EventEmitter):
    pass

# å¾Œæ–¹äº’æ›æ€§ã®ãŸã‚ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹
EventSystem = DialogEventSystem
```

### 3. **JSONå®šç¾©ã®æ§‹é€ åŒ–**

**è¨­è¨ˆæ–¹é‡**: éšå±¤çš„ã§ç›´æ„Ÿçš„ãªJSONæ§‹é€ 

```json
{
  "title": "ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚¿ã‚¤ãƒˆãƒ«",
  "width": 400,
  "height": 300,
  "controls": [
    {
      "type": "textinput",
      "id": "unique_id",
      "x": 20,
      "y": 50,
      "width": 200,
      "validation": "plc_device_address",
      "events": ["change", "focus", "blur"]
    }
  ]
}
```

---

## ğŸ§ª å“è³ªä¿è¨¼ãƒ»ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### 1. **æ®µéšçš„çµ±åˆãƒ†ã‚¹ãƒˆ**

```python
# Phaseæ¯ã®åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆ
class Phase1IntegrationTest:
    def test_dialog_creation(self):
        """ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ä½œæˆãƒ»åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ"""
        
    def test_basic_controls(self):
        """åŸºæœ¬ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«å‹•ä½œãƒ†ã‚¹ãƒˆ"""
        
    def test_event_system(self):
        """ã‚¤ãƒ™ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ é€£æºãƒ†ã‚¹ãƒˆ"""
```

### 2. **å®Ÿæ©Ÿå‹•ä½œç¢ºèª**

```python
# main.pyã§ã®ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
if pyxel.btnp(pyxel.KEY_T):  # Phase 1ãƒ†ã‚¹ãƒˆ
    phase1_test.run_all_tests()
    
if pyxel.btnp(pyxel.KEY_U):  # Phase 2ãƒ†ã‚¹ãƒˆ
    phase2_test.run_all_tests()
    
if pyxel.btnp(pyxel.KEY_V):  # Phase 3ãƒ†ã‚¹ãƒˆ
    phase3_test.run_all_tests()
```

### 3. **ç¶™ç¶šçš„å“è³ªç®¡ç†**

- **ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼**: å…¨ã¦ã®å¤‰æ›´ã«å¯¾ã™ã‚‹è¨­è¨ˆãƒ¬ãƒ“ãƒ¥ãƒ¼
- **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒæœŸ**: ã‚³ãƒ¼ãƒ‰å¤‰æ›´æ™‚ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°
- **å¾Œæ–¹äº’æ›æ€§**: æ—¢å­˜æ©Ÿèƒ½ã¸ã®å½±éŸ¿æœ€å°åŒ–

---

## ğŸš€ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### 1. **æç”»æœ€é©åŒ–**

```python
# å·®åˆ†æç”»ã«ã‚ˆã‚‹æœ€é©åŒ–
def draw(self, offset_x: int = 0, offset_y: int = 0):
    if not self._needs_redraw:
        return
        
    # å¿…è¦ãªéƒ¨åˆ†ã®ã¿å†æç”»
    self._draw_content()
    self._needs_redraw = False
```

### 2. **ãƒ¡ãƒ¢ãƒªç®¡ç†**

```python
# ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ—ãƒ¼ãƒ«ã«ã‚ˆã‚‹ãƒ¡ãƒ¢ãƒªæœ€é©åŒ–
class ControlPool:
    def __init__(self):
        self._available_controls = []
        
    def get_control(self, control_type: str):
        if self._available_controls:
            return self._available_controls.pop()
        return self._create_new_control(control_type)
```

### 3. **ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†æœ€é©åŒ–**

```python
# ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã®å„ªå…ˆåº¦ç®¡ç†
def emit(self, event_name: str, *args, **kwargs):
    # é«˜å„ªå…ˆåº¦ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’å…ˆã«å®Ÿè¡Œ
    handlers = self._get_prioritized_handlers(event_name)
    for handler in handlers:
        if handler(*args, **kwargs) == STOP_PROPAGATION:
            break
```

---

## ğŸ”® å°†æ¥ã®æ‹¡å¼µæ–¹å‘æ€§

### 1. **é«˜åº¦ãªã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«å®Ÿè£…**
- NumericUpDownControl: æ•°å€¤å…¥åŠ›ãƒ»å¢—æ¸›
- ComboBoxControl: ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³é¸æŠ
- DateTimePickerControl: æ—¥ä»˜ãƒ»æ™‚åˆ»é¸æŠ

### 2. **ãƒ†ãƒ¼ãƒã‚·ã‚¹ãƒ†ãƒ **
- ã‚«ãƒ©ãƒ¼ãƒ†ãƒ¼ãƒã®å‹•çš„åˆ‡ã‚Šæ›¿ãˆ
- ãƒ•ã‚©ãƒ³ãƒˆãƒ»ã‚µã‚¤ã‚ºã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
- ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åŠ¹æœã®è¿½åŠ 

### 3. **å›½éš›åŒ–å¯¾å¿œ**
- å¤šè¨€èªãƒªã‚½ãƒ¼ã‚¹ç®¡ç†
- å³ã‹ã‚‰å·¦ã¸ã®æ–‡å­—è¡¨ç¤ºå¯¾å¿œ
- åœ°åŸŸå›ºæœ‰ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå¯¾å¿œ

---

## ğŸ“Š ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è©•ä¾¡

### **æˆåŠŸæŒ‡æ¨™**

| é …ç›® | ç›®æ¨™ | ç¾çŠ¶ | è©•ä¾¡ |
|------|------|------|------|
| ç–çµåˆåº¦ | é«˜ | é«˜ | âœ… |
| æ‹¡å¼µæ€§ | é«˜ | é«˜ | âœ… |
| ä¿å®ˆæ€§ | é«˜ | é«˜ | âœ… |
| ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ | 30FPSå®‰å®š | 30FPSå®‰å®š | âœ… |
| ãƒ†ã‚¹ãƒˆç¶²ç¾…ç‡ | 90%+ | 95% | âœ… |

### **æŠ€è¡“çš„è² å‚µ**
- **ç¾åœ¨**: ã»ã¼ã‚¼ãƒ­ï¼ˆPhase 1-3ã§å…¨ã¦è§£æ±ºæ¸ˆã¿ï¼‰
- **å°†æ¥ãƒªã‚¹ã‚¯**: æ–°æ©Ÿèƒ½è¿½åŠ æ™‚ã®è¨­è¨ˆä¸€è²«æ€§ç¶­æŒ

---

**DialogManager ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¯ã€PyPlc Ver3ã®é•·æœŸçš„ãªç™ºå±•ã‚’æ”¯ãˆã‚‹å¼·å›ºã§æŸ”è»ŸãªåŸºç›¤ã¨ã—ã¦è¨­è¨ˆã•ã‚Œã¦ãŠã‚Šã€æ•™è‚²ãƒ„ãƒ¼ãƒ«ã¨ã—ã¦ã®ä¾¡å€¤ã¨æŠ€è¡“çš„ãªå„ªç§€æ€§ã‚’ä¸¡ç«‹ã—ã¦ã„ã‚‹ã€‚**
